{% extends 'base.html.twig' %}

{% block title %}Review Assignment
{% endblock %}
{% block container_title %}Review Assignment
{% endblock %}
{% block body %}
	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
	
	<div class="row">

		<div class="col-12 py-4">

			<div class="accordion  accordion-toggle-arrow" id="accordionExample4">
				<div class="card">
					<div class="card-header" id="headingOne4">
						<div class="card-title" data-toggle="collapse" data-target="#collapseOne4">
							<i class="flaticon2-layers-1"></i>
							Assign reviewer 
						</div>
					</div>
					<div id="collapseOne4" class="collapse  " data-parent="#accordionExample4">
						<div class="card-body">
{{ form_start(form) }}
											<div class="row">
												{# {% for child in form.children %}

													{% if child.vars.name != "_token" %}

														{{input.input(child)}}
													{% endif %}
												{% endfor %} #}

											</div>
											<button type="submit" class="btn btn-primary  float-end">
												Assign   reviewer
											</button>
											{{ form_end(form) }}
						</div>
					</div>
				</div>


			</div>


		</div>
	</div>
	 
	 
	 <div class="card card-custom gutter-b my-0">
		<div class="card-header">
			<div class="card-title">
				<h3 class="card-label">Review Assignments</h3>
			</div>
		</div>
		<div class="card-body">
			<div class="example-preview">
				<ul class="nav nav-tabs" id="myTab" role="tablist">
					<li class="nav-item">
						<a class="nav-link active" id="home-tab" data-toggle="tab" href="#home">
							<span class="nav-icon">
								<i class="fa fa-calendar"></i>
							</span>
							<span class="nav-text">All Active  Assignment
								{# {% if myreviews|length>0%}

									<span class="label label-sm label-primary mr-2">{{myreviews|length}}</span>
									{% else %}

								{% endif %} #}
							</span>


						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link " id="profile-tab" data-toggle="tab" href="#profile" aria-controls="profile">
							<span class="nav-icon">
								<i class="fa fa-table"></i>
							</span>
							<span class="nav-text">Closed  assigned
								{# <span class="label label-sm label-danger mr-2">{{ myreviews|length + closeds|length}}</span> #}
							</span>
						</a>
					</li>

				</ul>
				<div class="tab-content mt-5" id="myTabContent">
					<div class="tab-pane fade active show" id="home" role="tabpanel" aria-labelledby="home-tab">
						<div class="table-responsive">
							{% set selected = 0 %}
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>#</th>
					<th>Reviewer</th>
					<th>Department</th>
					<th>Academic Rank</th>
					<th>Due date</th>


					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for review_assignment in irb_review_assignment|filter(r=> r.irbreviewer)   %}

					<tr>
						<td>{{ loop.index }}</td>
						{% if review_assignment.status == 1 %}
							{% set selected = selected + 1 %}
						{% endif %}

						<td>


							{# <a href="{{ path('researcher', {'id': review_assignment.irbreviewer.id}) }}" class='font-16 m-0     mb-1 align-right'>
								{{ review_assignment.irbreviewer }}
							</a> #}

							<a href="#" class="avatar-box thumb-xxs align-self-center">
								<span class="avatar-title bg-soft-info rounded-circle font-13 font-weight-normal">
									+{{ review_assignment.irbreviewer.reviewAssignments|length   }}
								</span>
							</a>


							{# {% if review_assignment.reassigned %}

								<a href="#" class="avatar-box thumb-xxs align-self-center">
									<span class="avatar-title bg-soft-danger rounded-circle font-13 font-weight-normal">
										Re
									</span>
								</a>
							{% endif %} #}

						</td>
						<td>{{ review_assignment.irbreviewer.profile}}</td>
						<td>{{ review_assignment.irbreviewer.profile}}</td>
						<td>{{ review_assignment.duedate ? review_assignment.duedate|date('Y-m-d') : '' }}</td>

{# 
<td>
		{% if review_assignment.acceptedAt %}
			<span class="badge bg-success">
				Accepted
			</span>
			at:
			{{ review_assignment.acceptedAt|date('d-m-y i:sa') }}

		{% elseif review_assignment.rejectedAt %}

			<span class="badge bg-danger">Rejected at:
			</span>
			{{ review_assignment.rejectedAt|date('d-m-y i:sa') }}
																																																																																																													
																																																																														
																																																																																						{% elseif  review_assignment.Closed == 1 %}
																																																																																							<span class="badge bg-warning">Review sent</span>
																																																																																						{% elseif  review_assignment.InactiveAssignment == 1 %}
																																																																																							<span class="badge bg-danger">Inactive
																																																																																							</span>
																																																																																						{% elseif  review_assignment.Declined == 1 %}
																																																																																							<span class="badge bg-danger">Declined</span>
																																																																																						{% else %}
																																																																																							<span class="badge bg-warning">Pending</span>
																																																																														
																																																																														
																																																																																						{% endif %} 
																																																																																						
																																																																													</td>
																																																																																						#}

<td nowrap="nowrap">

{{ include('sero/review_assignment/_delete_form.html.twig') }}


<div class="modal fade  " id="showDetailsModal{{ review_assignment.id}}" tabindex="-1" role="dialog" aria-labelledby="showDetailsModalTitle{{ review_assignment.id}}" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<h6 class="modal-title m-0" id="showDetailsModalTitle{{ review_assignment.id}}">Irbreviewer assignment details</h6>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<!--end modal-header-->
<div class="modal-body">


<div class="row">

{{ include('sero/review_assignment/_delete_form.html.twig') }}

<div class="col-lg-6 col-md-12 col-sm-12">

<div class="card">
<div class="card-body text-center">
 
<h5 class="fw-bold mt-3 mb-1">
<span class="text-muted mb-0">
{# {{review_assignment.irbreviewer.profile.firstName}}
{{review_assignment.irbreviewer.profile.lastName}} #}
</span>
</h5>
<p class="text-muted mb-0">
Number of Assignment:
{# <a href="{{path('his_assignment',{'id':review_assignment.irbreviewer.id})}}" class="avatar-box thumb-xxs align-self-center">
<span class="avatar-title bg-soft-info rounded-circle font-13 font-weight-normal">
+
{{review_assignment.irbreviewer.reviewAssignments|length}}
</span>
</a> #}
</p>
<div class="mb-3">
{# {% if review_assignment.irbreviewer.isreviewer %}
<a href="#" class="me-3 text-warning">External reviewer</a>
{% else %}
<a href="#" class="me-3 text-success">Internal IRB reviewer</a>

{% endif %} #}

{# {% if review_assignment.reassigned %}

<a href="#" class="avatar-box thumb-xxs align-self-center">
	<span class="avatar-title bg-soft-danger rounded-circle font-13 font-weight-normal">
		Re
	</span>
</a>
{% endif %} #}

</div>
<br>

{# <a href='{{path('researcher',{'id':review_assignment.irbreviewer.id})}}' class="btn btn-sm btn-soft-primary">About IRB reviewer</a>
<a href='{{path('his_assignment',{'id':review_assignment.irbreviewer.id})}}' class="btn btn-sm btn-soft-info">Invitations</a> #}


															{% if review_assignment.status == 1 %}
																{% set selected = selected + 1 %}
															{% endif %}
														</div>
													</div>
												</div>
												<div class="col-lg-6 col-md-12 col-sm-12">

													<div class="card">
														<div class="card-body text-center">


															Invitation Sent At:
															{{ review_assignment.InvitationSentAt ? review_assignment.InvitationSentAt|date('Y-m-d H:i') : '' }}<br>
															Invitation response due date:
															{{ review_assignment.duedate ? review_assignment.duedate|date('Y-m-d') : '' }}
															<br>
															<br>
{# <a class="badge bg-primary" href="{{ asset('/files/proposals/review_files/'~ review_assignment.FileTobeReviewedeclined ) }}">
																																																																																																																																																										File To be Reviewed    PDF
																																																																																																																																																										<i class="fa fa-download"></i>
																																																																																																																																																									</a> #}

															<br>
															<br>

															{# 
{% if review_assignment.IsRejected == 1 %}
<span class="badge bg-info" title="Invitation not sent">Rejected</span>
{% elseif  review_assignment.Closed == 1 %}
<span class="badge bg-warning">Closed</span>
<br>
{% elseif  review_assignment.InactiveAssignment == 1 %}
<span class="badge bg-danger">Inactive Assignment</span>
<br>
{% elseif  review_assignment.Declined == 1 %}
<span class="badge bg-primary">Declined</span>


{% endif %} #}


<br>
{% for review in review_assignments %}
																<h4>Review decision:<br>


																	{# {% if   review.remark==1 %}
																		<span class="text-danger">
																			Declined</span>

																	{% elseif   review.remark==2 %}
																		<span class="text-warning">
																			Accepted with major revision</span>
																	{% elseif   review.remark==3 %}
																		<span class="text-warning">
																			Accepted with minor revision
																		</span>
																	{% elseif   review.remark==4 %}

																		<span class="text-success">
																			Accepted
																		</span>

{% endif   %} #}
																</h4>
																{{review.AllowToView}}
															{% endfor %}

														</div>
													</div>
												</div>
											</div>


										</div>
										<!--end modal-body-->
										<!--end modal-footer-->
									</div>
									<!--end modal-content-->
								</div>
							</div>
							<!--end modal-dialog-->
						</td>

					</tr>


				{% else %}
					<tr>
						<td colspan="3">no records found</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>

						</div>
					</div>
					<div class="tab-pane fade " id="profile" role="tabpanel" aria-labelledby="profile-tab">
						<div class="table-responsive">
							 d

						</div>
					</div>
					<div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">Tab content 3</div>
				</div>
			</div>
		</div>
	</div>


	<div class="col-lg-12">
		<h4 class="text-d">
			Assigned   reviewers {{  irb_review_assignment|filter(r=> r.irbreviewer) |length}}
		 
		</h4>

		
		
{% endblock %}
